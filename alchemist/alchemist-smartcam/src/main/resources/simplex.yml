incarnation: protelis

variables:
  MaxCamerasPerTarget: &MaxCamerasPerTarget
    type: ArbitraryVariable
    parameters: [3]
  CameraSpeed: &CameraSpeed
    type: ArbitraryVariable
    parameters: [0.5]
  HumanSpeed: &HumanSpeed
    type: ArbitraryVariable
    parameters: [0.5]
  NumHumans: &NumHumans
    type: ArbitraryVariable
    parameters: [40]
  NumCameras: &NumCameras
    type: ArbitraryVariable
    parameters: [10]
  EnvironmentSize: &EnvironmentSize
    type: ArbitraryVariable
    parameters: [400.0]
  HalfEnvironmentSize: &HalfEnvironmentSize
    formula: EnvironmentSize / 2
  NetworkConnectionMaxDistance: &NetworkConnectionMaxDistance
    formula: EnvironmentSize * EnvironmentSize
  FoVAngle: &FoVAngle
    type: ArbitraryVariable
    parameters: [60]
  FoVDistance: &FoVDistance
    type: ArbitraryVariable
    parameters: [30]
  MaxDistanceBeforeChangeInDirection: &MaxDistanceBeforeChangeInDirection
    type: ArbitraryVariable
    parameters: [.inf]
  AngularSpeed: &AngularSpeed
    type: ArbitraryVariable
    parameters: [2]


environment:
  type: Rectangular2DEnvironment
  parameters: [*EnvironmentSize, *EnvironmentSize]

network-model:
  type: ConnectWithinDistance
  parameters: [*NetworkConnectionMaxDistance]

seeds:
  scenario: 0
  simulation: 1


programs:
  - &Human
    - time-distribution: 1
      type: ChemicalReaction
      # levy walk / levy flight
      actions:
        - type: ZigZagMove
          parameters: [*MaxDistanceBeforeChangeInDirection, *HumanSpeed]
    - time-distribution: 1
      type: ChemicalReaction
      actions:
        - type: RandomlyToggleMoleculeWithDuration
          parameters: [wanted, true, 0.05, 5, 100]
  - &Camera
    - time-distribution: 4
      type: ChemicalReaction
      actions:
        - type: See
          parameters: [*FoVDistance, *FoVAngle, vision]
    - time-distribution: 2
      type: ChemicalReaction
      conditions:
        - type: MoleculeHasConcentration
          parameters: [state, following]
      actions:
        - type: HeadTowardTarget
          parameters: [heading, *AngularSpeed]
        - type: MoveToTarget
          parameters: [destination, *CameraSpeed]
    - time-distribution: 1
      type: ChemicalReaction
      conditions:
        - type: MoleculeHasConcentration
          parameters: [state, exploring]
      actions:
        - type: Spin
          parameters: [*AngularSpeed]
        - type: ZigZagMove
          parameters: [*MaxDistanceBeforeChangeInDirection, *CameraSpeed]
    - time-distribution: 1
      program: simplex
    - program: send



displacements:
  - in:
      type: Circle
      parameters: [*NumHumans, 0, 0, *HalfEnvironmentSize]
    nodes:
      type: CircleNode
      parameters: [1]
    programs:
      - *Human
  - in:
      type: Circle
      parameters: [*NumCameras, 0, 0, *HalfEnvironmentSize]
    nodes:
      type: ProtelisNode
      parameters: [1]
    contents:
      - molecule: Target
        concentration: wanted
      - molecule: MaxCamerasPerTarget
        concentration: *MaxCamerasPerTarget
      - molecule: FoVDistance
        concentration: *FoVDistance
    programs:
      - *Camera


